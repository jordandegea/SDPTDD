---
# Define the workers in the Vagrant testing environment
# Each entry defines the hostname of the machine
#
# Default config options, referenced using YAML syntax
defaults:
  # Default options for hosts
  hosts: &host_defaults
    user: vagrant     # Default non-privileged user
    cpus: 1           # Default number of CPUs for vagrant
    memory: 2048      # Default RAM amount (MB)
# Known services definitions
services:
  - zookeeper
  - service_watcher
  - kafka
  - flink
  - hbase
  - zeppelin
  - flink_city@paris
  - flink_city@london
  - flink_city@nyc
  - flink_producer_fake
# Deployment specifications
deploy:
  variables:
    hostspec: '<%= hosts.map { |h| "-H #{h.name}@#{h.address}" }.join(" ") %>'
    quorum: '<%= hosts.map(&:name).join(",") %>'
    zkquorum: '<%= hosts.map { |h| "#{h.name}:2181" }.join(",") %>'
    flinkbootstrap: '<%= hosts.map { |h| "#{h.name}:9092" }.join(",") %>'
  # Shared arguments to apply to all provision scripts
  # SPEC: Use '-v' to indicate Vagrant provision
  shared_args: -v
  # List of provisioning steps.
  bootstrap:
    - hosts: $hostspec
    - ssh: $hostspec
  system:
    - apt:
    - java:
    - python:
  software:
    - kafka:
    - flink:
    - hbase:
    - zeppelin:
  settings:
    - service_watcher: -z $zkquorum
    - kafka: $hostspec
    - flink: -q $quorum -F $flinkbootstrap
    - hbase: -q $quorum
    - zeppelin:
  code:
    - service_watcher:
    - flink:
  # List of source folders to include in the ~/deploy directory when provision
  # Note that the *contents* of mentioned directories are copied in the deploy
  # directory
  bootstrap_folders:
    - ../source/shared
    - ../source/bootstrap
    - .vagrant
  system_folders:
    - ../source/shared
    - ../source/system
  software_folders:
    - ../source/shared
    - ../source/software
  settings_folders:
    - ../source/shared
    - ../source/settings
  code_folders:
    - ../source/shared
    - ../source/code
  configure_folders:
    - ../source/shared
    - ../source/configure
# One-shot run command specifications
run:
  format_hdfs: /usr/local/hadoop/bin/hdfs namenode -format
# Hosts definitions
hosts:
  worker1:
    <<: *host_defaults
    key: .vagrant/machines/worker1/virtualbox/private_key
    ip: 10.20.1.100
    services: # List of services to enable/start on worker1
      - zookeeper
      - service_watcher
      - kafka
      - flink
      - hbase
      - flink_city@paris
      - flink_producer_fake
    configure:
      after:
        - create_topics: "-t paris -t london -t nyc"
  worker2:
    <<: *host_defaults
    key: .vagrant/machines/worker2/virtualbox/private_key
    ip: 10.20.1.101
    services: # List of services to enable/start on worker2
      - zookeeper
      - service_watcher
      - kafka
      - flink
      - hbase
      # - flink_city@london
  worker3:
    <<: *host_defaults
    key: .vagrant/machines/worker3/virtualbox/private_key
    ip: 10.20.1.102
    services: # List of services to enable/start on worker3
      - zookeeper
      - service_watcher
      - kafka
      - flink
      - hbase
      # - flink_city@nyc
