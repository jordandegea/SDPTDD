{"paragraphs":[{"text":"%flink\nimport java.util.Date\n\nimport org.apache.flink.addons.hbase.TableInputFormat\nimport org.apache.flink.api.scala.{DataSet, ExecutionEnvironment}\nimport org.apache.flink.util.Collector\nimport org.apache.hadoop.hbase.client.{Result, Scan}\nimport org.apache.hadoop.hbase.util.Bytes\nimport org.apache.flink.api.java.tuple\n\nimport scala.collection.mutable\n\n/* Dependencies\norg.apache.flink:flink-hbase_2.11:1.1.3\norg.apache.hbase:hbase-common:1.0.3\norg.apache.hbase:hbase-client:1.0.3\n */\n\n@SerialVersionUID(102L)\nclass TwitterTableFormat(tableName: String) extends TableInputFormat[tuple.Tuple2[Date, Long]] with Serializable {\n    override def mapResultToTuple(r: Result): tuple.Tuple2[Date, Long] = {\n        val createdAtValue = r.getValue(Bytes.toBytes(\"tweet\"), Bytes.toBytes(\"created_at\"))\n        val feelingValue = r.getValue(Bytes.toBytes(\"feeling\"), Bytes.toBytes(\"level\"))\n\n        new tuple.Tuple2(new Date(parseLong(createdAtValue)), parseLong(feelingValue))\n    }\n\n    def parseLong(src: Array[Byte]): Long = {\n        Bytes.toLong(src)\n    }\n\n    override def getTableName: String = {\n        tableName\n    }\n\n    override def getScanner: Scan = {\n        val scan = new Scan()\n        scan.addColumn(Bytes.toBytes(\"tweet\"), Bytes.toBytes(\"created_at\"))\n        scan.addColumn(Bytes.toBytes(\"feeling\"), Bytes.toBytes(\"level\"))\n        scan\n    }\n}\n\nobject utils {\n    def table(name: String): DataSet[(Date, String, Long)] = {\n        benv.createInput(new TwitterTableFormat(name + \"_tweets\")).map(i => (i.f0, name, i.f1))\n    }\n}","dateUpdated":"2017-01-25T01:21:54+0000","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala","editorHide":false},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1485292266801_-284257915","id":"20170124-211106_965426283","result":{"code":"SUCCESS","type":"TEXT","msg":"import java.util.Date\nimport org.apache.flink.addons.hbase.TableInputFormat\nimport org.apache.flink.api.scala.{DataSet, ExecutionEnvironment}\nimport org.apache.flink.util.Collector\nimport org.apache.hadoop.hbase.client.{Result, Scan}\nimport org.apache.hadoop.hbase.util.Bytes\nimport org.apache.flink.api.java.tuple\nimport scala.collection.mutable\ndefined class TwitterTableFormat\ndefined object utils\ndefined class CountAggregator\n"},"dateCreated":"2017-01-24T21:11:06+0000","dateStarted":"2017-01-25T00:55:09+0000","dateFinished":"2017-01-25T00:55:16+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:10966","focus":true},{"text":"%flink\nval tableNames = Array(\"paris\", \"london\", \"nyc\")\nvar table = utils.table(tableNames(0))\ntableNames.drop(1).foreach(name => table = table.union(utils.table(name)))\n\nval factor = 5L * 60L * 1000L\nval result: DataSet[(Date, Long, Long, Long)] = utils.table(tableNames(0)).map(i => (i._1.getTime / factor, i._2, i._3))\n    .coGroup(utils.table(tableNames(1)).map(i => (i._1.getTime / factor, i._2, i._3)))\n    .where(0).equalTo(0) {\n    (tLeft, tRight, out: Collector[(Long, Long, Long)]) =>\n        out.collect((tLeft.toSeq.head._1, tLeft.map(x => x._3).sum[Long], tRight.map(x => x._3).sum[Long]))\n}.coGroup(utils.table(tableNames(2)).map(i => (i._1.getTime / factor, i._2, i._3)))\n    .where(0).equalTo(0) {\n    (tLeft, tRight, out: Collector[(Date, Long, Long, Long)]) =>\n        val only = tLeft.toSeq.head\n        out.collect((new Date(only._1 * factor), only._2, only._3, tRight.map(x => x._3).sum[Long]))\n}\nprintln(\"%table\")\nprint(\"Date\")\ntableNames.foreach(n => printf(\"\\t%s\", n))\nprintln()\nresult.collect.foreach(i => printf(\"%s\\t%s\\t%s\\t%s\\n\", i._1, i._2, i._3, i._4))","dateUpdated":"2017-01-25T01:22:41+0000","config":{"colWidth":12,"graph":{"mode":"lineChart","height":300,"optionOpen":false,"keys":[{"name":"Date","index":0,"aggr":"sum"}],"values":[{"name":"paris","index":1,"aggr":"sum"},{"name":"london","index":2,"aggr":"sum"},{"name":"nyc","index":3,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"Date","index":0,"aggr":"sum"},"yAxis":{"name":"paris","index":1,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1485302485356_1749498385","id":"20170125-000125_466841857","dateCreated":"2017-01-25T00:01:25+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:10968","dateFinished":"2017-01-25T01:21:02+0000","dateStarted":"2017-01-25T01:20:17+0000","result":{"code":"SUCCESS","type":"TABLE","msg":"Date\tparis\tlondon\tnyc\nTue Jan 24 20:55:00 UTC 2017\t84\t127\t260\nTue Jan 24 21:00:00 UTC 2017\t268\t533\t604\nTue Jan 24 21:05:00 UTC 2017\t292\t517\t643\nTue Jan 24 21:10:00 UTC 2017\t249\t490\t545\nTue Jan 24 21:15:00 UTC 2017\t217\t401\t633\nTue Jan 24 21:20:00 UTC 2017\t241\t489\t583\nTue Jan 24 21:25:00 UTC 2017\t230\t470\t457\nTue Jan 24 21:30:00 UTC 2017\t293\t384\t521\nTue Jan 24 21:35:00 UTC 2017\t330\t529\t525\nTue Jan 24 21:40:00 UTC 2017\t284\t550\t538\nTue Jan 24 21:45:00 UTC 2017\t286\t577\t571\nTue Jan 24 21:50:00 UTC 2017\t356\t511\t612\nTue Jan 24 21:55:00 UTC 2017\t282\t593\t600\nTue Jan 24 22:00:00 UTC 2017\t247\t575\t699\nTue Jan 24 22:05:00 UTC 2017\t354\t541\t680\nTue Jan 24 22:10:00 UTC 2017\t322\t521\t631\nTue Jan 24 22:15:00 UTC 2017\t320\t560\t612\nTue Jan 24 22:20:00 UTC 2017\t267\t609\t625\nTue Jan 24 22:25:00 UTC 2017\t353\t553\t495\nTue Jan 24 22:30:00 UTC 2017\t270\t451\t674\nTue Jan 24 22:35:00 UTC 2017\t243\t521\t485\nTue Jan 24 22:40:00 UTC 2017\t264\t653\t477\nTue Jan 24 22:45:00 UTC 2017\t206\t447\t473\nTue Jan 24 22:50:00 UTC 2017\t316\t703\t487\nTue Jan 24 22:55:00 UTC 2017\t229\t461\t522\nTue Jan 24 23:00:00 UTC 2017\t310\t521\t404\nTue Jan 24 23:05:00 UTC 2017\t236\t485\t539\nTue Jan 24 23:10:00 UTC 2017\t214\t463\t481\nTue Jan 24 23:15:00 UTC 2017\t198\t459\t515\nTue Jan 24 23:20:00 UTC 2017\t317\t552\t493\nTue Jan 24 23:25:00 UTC 2017\t228\t465\t367\nTue Jan 24 23:30:00 UTC 2017\t230\t365\t441\nTue Jan 24 23:35:00 UTC 2017\t181\t407\t554\nTue Jan 24 23:40:00 UTC 2017\t272\t385\t420\nTue Jan 24 23:45:00 UTC 2017\t207\t464\t530\nTue Jan 24 23:50:00 UTC 2017\t229\t525\t470\nTue Jan 24 23:55:00 UTC 2017\t293\t501\t460\nWed Jan 25 00:00:00 UTC 2017\t288\t470\t495\nWed Jan 25 00:05:00 UTC 2017\t269\t478\t387\nWed Jan 25 00:10:00 UTC 2017\t199\t566\t361\nWed Jan 25 00:15:00 UTC 2017\t283\t451\t506\nWed Jan 25 00:20:00 UTC 2017\t155\t370\t451\nWed Jan 25 00:25:00 UTC 2017\t203\t313\t368\nWed Jan 25 00:30:00 UTC 2017\t204\t546\t476\nWed Jan 25 00:35:00 UTC 2017\t168\t402\t540\nWed Jan 25 00:40:00 UTC 2017\t186\t289\t500\nWed Jan 25 00:45:00 UTC 2017\t254\t426\t307\nWed Jan 25 00:50:00 UTC 2017\t249\t386\t454\nWed Jan 25 00:55:00 UTC 2017\t216\t382\t338\nWed Jan 25 01:00:00 UTC 2017\t129\t348\t389\nWed Jan 25 01:05:00 UTC 2017\t242\t471\t484\nWed Jan 25 01:10:00 UTC 2017\t183\t405\t440\nWed Jan 25 01:15:00 UTC 2017\t155\t464\t391\nWed Jan 25 01:20:00 UTC 2017\t35\t64\t43\n","comment":"","msgTable":[[{"key":"paris","value":"Tue Jan 24 20:55:00 UTC 2017"},{"key":"paris","value":"84"},{"key":"paris","value":"127"},{"key":"paris","value":"260"}],[{"key":"london","value":"Tue Jan 24 21:00:00 UTC 2017"},{"key":"london","value":"268"},{"key":"london","value":"533"},{"key":"london","value":"604"}],[{"key":"nyc","value":"Tue Jan 24 21:05:00 UTC 2017"},{"key":"nyc","value":"292"},{"key":"nyc","value":"517"},{"key":"nyc","value":"643"}],[{"value":"Tue Jan 24 21:10:00 UTC 2017"},{"value":"249"},{"value":"490"},{"value":"545"}],[{"value":"Tue Jan 24 21:15:00 UTC 2017"},{"value":"217"},{"value":"401"},{"value":"633"}],[{"value":"Tue Jan 24 21:20:00 UTC 2017"},{"value":"241"},{"value":"489"},{"value":"583"}],[{"value":"Tue Jan 24 21:25:00 UTC 2017"},{"value":"230"},{"value":"470"},{"value":"457"}],[{"value":"Tue Jan 24 21:30:00 UTC 2017"},{"value":"293"},{"value":"384"},{"value":"521"}],[{"value":"Tue Jan 24 21:35:00 UTC 2017"},{"value":"330"},{"value":"529"},{"value":"525"}],[{"value":"Tue Jan 24 21:40:00 UTC 2017"},{"value":"284"},{"value":"550"},{"value":"538"}],[{"value":"Tue Jan 24 21:45:00 UTC 2017"},{"value":"286"},{"value":"577"},{"value":"571"}],[{"value":"Tue Jan 24 21:50:00 UTC 2017"},{"value":"356"},{"value":"511"},{"value":"612"}],[{"value":"Tue Jan 24 21:55:00 UTC 2017"},{"value":"282"},{"value":"593"},{"value":"600"}],[{"value":"Tue Jan 24 22:00:00 UTC 2017"},{"value":"247"},{"value":"575"},{"value":"699"}],[{"value":"Tue Jan 24 22:05:00 UTC 2017"},{"value":"354"},{"value":"541"},{"value":"680"}],[{"value":"Tue Jan 24 22:10:00 UTC 2017"},{"value":"322"},{"value":"521"},{"value":"631"}],[{"value":"Tue Jan 24 22:15:00 UTC 2017"},{"value":"320"},{"value":"560"},{"value":"612"}],[{"value":"Tue Jan 24 22:20:00 UTC 2017"},{"value":"267"},{"value":"609"},{"value":"625"}],[{"value":"Tue Jan 24 22:25:00 UTC 2017"},{"value":"353"},{"value":"553"},{"value":"495"}],[{"value":"Tue Jan 24 22:30:00 UTC 2017"},{"value":"270"},{"value":"451"},{"value":"674"}],[{"value":"Tue Jan 24 22:35:00 UTC 2017"},{"value":"243"},{"value":"521"},{"value":"485"}],[{"value":"Tue Jan 24 22:40:00 UTC 2017"},{"value":"264"},{"value":"653"},{"value":"477"}],[{"value":"Tue Jan 24 22:45:00 UTC 2017"},{"value":"206"},{"value":"447"},{"value":"473"}],[{"value":"Tue Jan 24 22:50:00 UTC 2017"},{"value":"316"},{"value":"703"},{"value":"487"}],[{"value":"Tue Jan 24 22:55:00 UTC 2017"},{"value":"229"},{"value":"461"},{"value":"522"}],[{"value":"Tue Jan 24 23:00:00 UTC 2017"},{"value":"310"},{"value":"521"},{"value":"404"}],[{"value":"Tue Jan 24 23:05:00 UTC 2017"},{"value":"236"},{"value":"485"},{"value":"539"}],[{"value":"Tue Jan 24 23:10:00 UTC 2017"},{"value":"214"},{"value":"463"},{"value":"481"}],[{"value":"Tue Jan 24 23:15:00 UTC 2017"},{"value":"198"},{"value":"459"},{"value":"515"}],[{"value":"Tue Jan 24 23:20:00 UTC 2017"},{"value":"317"},{"value":"552"},{"value":"493"}],[{"value":"Tue Jan 24 23:25:00 UTC 2017"},{"value":"228"},{"value":"465"},{"value":"367"}],[{"value":"Tue Jan 24 23:30:00 UTC 2017"},{"value":"230"},{"value":"365"},{"value":"441"}],[{"value":"Tue Jan 24 23:35:00 UTC 2017"},{"value":"181"},{"value":"407"},{"value":"554"}],[{"value":"Tue Jan 24 23:40:00 UTC 2017"},{"value":"272"},{"value":"385"},{"value":"420"}],[{"value":"Tue Jan 24 23:45:00 UTC 2017"},{"value":"207"},{"value":"464"},{"value":"530"}],[{"value":"Tue Jan 24 23:50:00 UTC 2017"},{"value":"229"},{"value":"525"},{"value":"470"}],[{"value":"Tue Jan 24 23:55:00 UTC 2017"},{"value":"293"},{"value":"501"},{"value":"460"}],[{"value":"Wed Jan 25 00:00:00 UTC 2017"},{"value":"288"},{"value":"470"},{"value":"495"}],[{"value":"Wed Jan 25 00:05:00 UTC 2017"},{"value":"269"},{"value":"478"},{"value":"387"}],[{"value":"Wed Jan 25 00:10:00 UTC 2017"},{"value":"199"},{"value":"566"},{"value":"361"}],[{"value":"Wed Jan 25 00:15:00 UTC 2017"},{"value":"283"},{"value":"451"},{"value":"506"}],[{"value":"Wed Jan 25 00:20:00 UTC 2017"},{"value":"155"},{"value":"370"},{"value":"451"}],[{"value":"Wed Jan 25 00:25:00 UTC 2017"},{"value":"203"},{"value":"313"},{"value":"368"}],[{"value":"Wed Jan 25 00:30:00 UTC 2017"},{"value":"204"},{"value":"546"},{"value":"476"}],[{"value":"Wed Jan 25 00:35:00 UTC 2017"},{"value":"168"},{"value":"402"},{"value":"540"}],[{"value":"Wed Jan 25 00:40:00 UTC 2017"},{"value":"186"},{"value":"289"},{"value":"500"}],[{"value":"Wed Jan 25 00:45:00 UTC 2017"},{"value":"254"},{"value":"426"},{"value":"307"}],[{"value":"Wed Jan 25 00:50:00 UTC 2017"},{"value":"249"},{"value":"386"},{"value":"454"}],[{"value":"Wed Jan 25 00:55:00 UTC 2017"},{"value":"216"},{"value":"382"},{"value":"338"}],[{"value":"Wed Jan 25 01:00:00 UTC 2017"},{"value":"129"},{"value":"348"},{"value":"389"}],[{"value":"Wed Jan 25 01:05:00 UTC 2017"},{"value":"242"},{"value":"471"},{"value":"484"}],[{"value":"Wed Jan 25 01:10:00 UTC 2017"},{"value":"183"},{"value":"405"},{"value":"440"}],[{"value":"Wed Jan 25 01:15:00 UTC 2017"},{"value":"155"},{"value":"464"},{"value":"391"}],[{"value":"Wed Jan 25 01:20:00 UTC 2017"},{"value":"35"},{"value":"64"},{"value":"43"}]],"columnNames":[{"name":"Date","index":0,"aggr":"sum"},{"name":"paris","index":1,"aggr":"sum"},{"name":"london","index":2,"aggr":"sum"},{"name":"nyc","index":3,"aggr":"sum"}],"rows":[["Tue Jan 24 20:55:00 UTC 2017","84","127","260"],["Tue Jan 24 21:00:00 UTC 2017","268","533","604"],["Tue Jan 24 21:05:00 UTC 2017","292","517","643"],["Tue Jan 24 21:10:00 UTC 2017","249","490","545"],["Tue Jan 24 21:15:00 UTC 2017","217","401","633"],["Tue Jan 24 21:20:00 UTC 2017","241","489","583"],["Tue Jan 24 21:25:00 UTC 2017","230","470","457"],["Tue Jan 24 21:30:00 UTC 2017","293","384","521"],["Tue Jan 24 21:35:00 UTC 2017","330","529","525"],["Tue Jan 24 21:40:00 UTC 2017","284","550","538"],["Tue Jan 24 21:45:00 UTC 2017","286","577","571"],["Tue Jan 24 21:50:00 UTC 2017","356","511","612"],["Tue Jan 24 21:55:00 UTC 2017","282","593","600"],["Tue Jan 24 22:00:00 UTC 2017","247","575","699"],["Tue Jan 24 22:05:00 UTC 2017","354","541","680"],["Tue Jan 24 22:10:00 UTC 2017","322","521","631"],["Tue Jan 24 22:15:00 UTC 2017","320","560","612"],["Tue Jan 24 22:20:00 UTC 2017","267","609","625"],["Tue Jan 24 22:25:00 UTC 2017","353","553","495"],["Tue Jan 24 22:30:00 UTC 2017","270","451","674"],["Tue Jan 24 22:35:00 UTC 2017","243","521","485"],["Tue Jan 24 22:40:00 UTC 2017","264","653","477"],["Tue Jan 24 22:45:00 UTC 2017","206","447","473"],["Tue Jan 24 22:50:00 UTC 2017","316","703","487"],["Tue Jan 24 22:55:00 UTC 2017","229","461","522"],["Tue Jan 24 23:00:00 UTC 2017","310","521","404"],["Tue Jan 24 23:05:00 UTC 2017","236","485","539"],["Tue Jan 24 23:10:00 UTC 2017","214","463","481"],["Tue Jan 24 23:15:00 UTC 2017","198","459","515"],["Tue Jan 24 23:20:00 UTC 2017","317","552","493"],["Tue Jan 24 23:25:00 UTC 2017","228","465","367"],["Tue Jan 24 23:30:00 UTC 2017","230","365","441"],["Tue Jan 24 23:35:00 UTC 2017","181","407","554"],["Tue Jan 24 23:40:00 UTC 2017","272","385","420"],["Tue Jan 24 23:45:00 UTC 2017","207","464","530"],["Tue Jan 24 23:50:00 UTC 2017","229","525","470"],["Tue Jan 24 23:55:00 UTC 2017","293","501","460"],["Wed Jan 25 00:00:00 UTC 2017","288","470","495"],["Wed Jan 25 00:05:00 UTC 2017","269","478","387"],["Wed Jan 25 00:10:00 UTC 2017","199","566","361"],["Wed Jan 25 00:15:00 UTC 2017","283","451","506"],["Wed Jan 25 00:20:00 UTC 2017","155","370","451"],["Wed Jan 25 00:25:00 UTC 2017","203","313","368"],["Wed Jan 25 00:30:00 UTC 2017","204","546","476"],["Wed Jan 25 00:35:00 UTC 2017","168","402","540"],["Wed Jan 25 00:40:00 UTC 2017","186","289","500"],["Wed Jan 25 00:45:00 UTC 2017","254","426","307"],["Wed Jan 25 00:50:00 UTC 2017","249","386","454"],["Wed Jan 25 00:55:00 UTC 2017","216","382","338"],["Wed Jan 25 01:00:00 UTC 2017","129","348","389"],["Wed Jan 25 01:05:00 UTC 2017","242","471","484"],["Wed Jan 25 01:10:00 UTC 2017","183","405","440"],["Wed Jan 25 01:15:00 UTC 2017","155","464","391"],["Wed Jan 25 01:20:00 UTC 2017","35","64","43"]]},"focus":true},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1485305803604_1532384285","id":"20170125-005643_133999413","dateCreated":"2017-01-25T00:56:43+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:11430","dateUpdated":"2017-01-25T00:56:53+0000","text":""}],"name":"Twitter","id":"2CA5DSGVW","angularObjects":{"2C7USAZ7Y:shared_process":[],"2C96PW5H8:shared_process":[],"2C9SJGWHE:shared_process":[],"2C7G7H5TF:shared_process":[],"2C8JGQ8SF:shared_process":[],"2C73E1RX9:shared_process":[],"2C98GAMN1:shared_process":[],"2C7VMGBRY:shared_process":[],"2C7SMKA8E:shared_process":[],"2C7JY2HKN:shared_process":[],"2C6X2BPUD:shared_process":[],"2C7D86M38:shared_process":[],"2C9D42ADJ:shared_process":[],"2C7WVBXGQ:shared_process":[],"2C8FHANN4:shared_process":[],"2C9TD5BGZ:shared_process":[],"2C7CY4P9Q:shared_process":[],"2CA4Q3DWW:shared_process":[]},"config":{"looknfeel":"default"},"info":{}}